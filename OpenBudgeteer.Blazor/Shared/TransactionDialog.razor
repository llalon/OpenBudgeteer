@using System.Drawing
@using System.Globalization
@using OpenBudgeteer.Core.Data.Entities.Models
@using OpenBudgeteer.Core.ViewModels.EntityViewModels
@using OpenBudgeteer.Core.ViewModels.Helper
@using Color = MudBlazor.Color
@using Size = MudBlazor.Size

<MudDialog Class="dialog-background">
    <TitleContent>
        <MudText Typo="Typo.h6">@Title</MudText>
    </TitleContent>
    <DialogContent>
        <MudDataGrid
            T="TransactionViewModel"
            Items="@DataContext.Transactions"
            Dense="true"
            Filterable="true"
            FixedHeader="true"
            Hover="true"
            ReadOnly="true"
            RowsPerPage="@PagerSize"
            SortMode="SortMode.Multiple">
            <Columns>
                <PropertyColumn Property="x => x.TransactionDate" Title="Date">
                    <CellTemplate>
                        <MudText>@context.Item.TransactionDate.ToShortDateString()</MudText>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.SelectedAccount" Title="Account" CellStyle="min-width: 150px">
                    <CellTemplate>
                        <MudText>@context.Item.SelectedAccount.Name</MudText>
                    </CellTemplate>
                </PropertyColumn>
                <PropertyColumn Property="x => x.Payee"/>
                <PropertyColumn Property="x => x.Memo"/>
                <PropertyColumn Property="x => x.Amount">
                    <CellTemplate>
                        <MudText Class="col-numbers">@context.Item.Amount.ToString("C", CultureInfo.CurrentCulture)</MudText>
                    </CellTemplate>
                </PropertyColumn>
            </Columns>
            <PagerContent>
                <MudDataGridPager T="TransactionViewModel" />
            </PagerContent>
        </MudDataGrid>
    </DialogContent>
    <DialogActions>
        <MudButton Variant="Variant.Filled" Size="Size.Small" Color="Color.Error" OnClick="CloseDialog">Close</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; } = null!;
    
    [Parameter]
    public string Title { get; set; } = string.Empty;

    [Parameter]
    public TransactionListingViewModel DataContext { get; set; } = null!;

    [Parameter]
    public bool IsDialogVisible { get; set; }

    [Parameter]
    public bool IsDialogLoading { get; set; }

	[Parameter]
    public Bucket CurrentBucket { get; set; } = null!;

    [Parameter]
    public EventCallback<MouseEventArgs> OnClickCallback { get; set; }

    private int PagerSize { get; set; } = 25;
    
    private void CloseDialog() => MudDialog.Close(DialogResult.Ok(true));
}
