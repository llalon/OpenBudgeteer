@page "/rules"
@using System.Drawing
@using OpenBudgeteer.Core.ViewModels.EntityViewModels
@using Color = MudBlazor.Color
@using Size = MudBlazor.Size

<MudStack Row Spacing="1">
    <MudButton Class="me-2 mb-2" Variant="Variant.Filled" Size="Size.Small" Color="Color.Primary" OnClick="() => ShowEditRuleSetDialog(null)">Create Rule</MudButton>
    @if (_selectedRuleSets.Count > 0)
    {
        <MudButton Class="me-2 mb-2" Variant="Variant.Filled" Size="Size.Small" Color="Color.Error" OnClick="DeleteSelectedRuleSets">Delete @_selectedRuleSets.Count Selected</MudButton>
    }
</MudStack>

<MudDataGrid
    T="RuleSetViewModel"
    Items="@_dataContext.RuleSets"
    Dense="true"
    EditMode="DataGridEditMode.Form"
    Filterable="true"
    Hover="true"
    MultiSelection="true"
    ReadOnly="true"
    SortMode="SortMode.Multiple"
    SelectedItemsChanged="RuleSet_SelectionChanged">
    <Columns>
        <SelectColumn T="RuleSetViewModel" />
        <PropertyColumn Property="x => x.Priority"/>
        <PropertyColumn Property="x => x.Name"/>
        <PropertyColumn Property="x => x.TargetBucketName" Title="Target Bucket">
            <CellTemplate>
                <MudPaper
                    Class="d-flex align-center justify-center mud-width-full bucket-indicator no-background"
                    Style="@($"background-color: {ColorTranslator.ToHtml(context.Item.TargetBucketColor)}; color: {ColorTranslator.ToHtml(context.Item.TargetBucketTextColor)}")">
                    <MudText>@context.Item.TargetBucketName</MudText>
                </MudPaper>
            </CellTemplate>
        </PropertyColumn>
        <PropertyColumn Property="x => x.MappingRules" Title="Mapping Rules">
            <CellTemplate>
                <MudStack Spacing="0">
                    @foreach (var mappingRule in context.Item.MappingRules)
                    {
                        <MudText>@mappingRule.ToString()</MudText>
                    }
                </MudStack>
            </CellTemplate>
        </PropertyColumn>
        <TemplateColumn>
            <CellTemplate>
                <MudStack AlignItems="AlignItems.End">
                    <MudIconButton Size="@Size.Small" Icon="@Icons.Material.Outlined.Edit" OnClick="() => ShowEditRuleSetDialog(context.Item)"/>
                </MudStack>
            </CellTemplate>
        </TemplateColumn>
    </Columns>
</MudDataGrid>
